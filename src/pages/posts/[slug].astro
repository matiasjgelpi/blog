---
import { ChevronLeft, Calendar, Clock, Tag } from "lucide-react";
import Header from "@/components/Header.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection, getEntry } from "astro:content";

const { slug } = Astro.params;

const post = await getEntry("posts", slug);

if (!post) {
  return Astro.redirect("/404");
}

const postData = await post?.data;
const { Content } = await post?.render();

export async function getStaticPaths() {
  const posts = await getCollection("posts");

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}
---

<Layout>
  <Header />

  <main class="max-w-4xl mx-auto px-6 py-8">
    <!-- Navegación de regreso -->
    <nav class="mb-8">
      <a
        href="/"
        class="inline-flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors font-serif-body text-sm"
      >
        <ChevronLeft className="w-4 h-4" />
        Volver a las notas
      </a>
    </nav>

    <!-- Header del post -->
    <header class="mb-8 pb-8 border-b border-border">
      <div
        class="flex items-center gap-4 text-xs text-muted-foreground uppercase tracking-wide font-serif-body mb-4"
      >
        <span class="inline-flex items-center gap-1">
          <Tag className="w-3 h-3" />
          {postData?.category}
        </span>
        <span>•</span>
        <span class="inline-flex items-center gap-1">
          <Calendar className="w-3 h-3" />
          {postData?.date.toLocaleDateString("es-ES")}
        </span>
        <span>•</span>
        <span class="inline-flex items-center gap-1">
          <Clock className="w-3 h-3" />
          {postData?.readTime}
        </span>
      </div>

      <h1
        class="font-serif-display text-3xl lg:text-4xl font-bold text-foreground leading-tight mb-4"
      >
        {postData?.title}
      </h1>

      <p class="text-lg text-muted-foreground leading-relaxed font-serif-body">
        {postData?.excerpt}
      </p>
    </header>

    <!-- Contenido del post -->
    <article class="prose prose-lg max-w-none">
      <Content />
    </article>

    <!-- Footer del post -->
    <footer class="mt-12 pt-8 border-t border-border">
      <div class="flex items-center justify-between">
        <a
          href="/"
          class="text-primary hover:underline font-serif-body text-sm"
        >
          ← Más notas marginales
        </a>
        <p class="text-xs text-muted-foreground font-serif-body">
          © 2024 Matías Gelpi
        </p>
      </div>
    </footer>
  </main>
</Layout>
