---
import { getCollection, getEntry } from 'astro:content'
import Layout from '../../layouts/Layout.astro'

export async function getStaticPaths() {
  const posts = await getCollection("posts");

  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getEntry('posts', slug)

if (!post) {
  throw new Error(`Post no encontrado para slug: ${slug}`);
}

const { Content } = await post?.render()

// Get reading time estimation
const content = await post.render();
const text = content.remarkPluginFrontmatter?.excerpt || '';
const wordsPerMinute = 200;
const words = text.split(' ').length;
const readingTime = Math.ceil(words / wordsPerMinute);
---

<Layout>
  <!-- Navigation with back button -->
  <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 backdrop-blur-sm bg-white/90">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <a 
          href="/" 
          class="inline-flex items-center font-ui font-medium text-charcoal hover:text-primary-blue transition-colors duration-300"
        >
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m0 0l7 7-7 7z" />
          </svg>
          Volver a Reflexiones
        </a>
        
        <div class="flex items-center space-x-6 font-ui text-sm text-medium-gray">
          <span>{readingTime} min de lectura</span>
          {post.data.date && (
            <time datetime={new Date(post.data.date).toISOString()}>
              {new Date(post.data.date).toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
          )}
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero section for the post -->
  <section class="bg-gradient-to-br from-light-gray to-blue-50 py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-heading font-semibold text-dark-navy mb-6 tracking-tighter-elegant leading-tight">
          {post.data.title}
        </h1>
        
        {post.data.description && (
          <p class="text-xl md:text-2xl font-body text-charcoal mb-8 max-w-3xl mx-auto leading-relaxed tracking-elegant">
            {post.data.description}
          </p>
        )}
        
        <!-- Post metadata -->
        <div class="flex flex-wrap justify-center items-center gap-6 text-medium-gray font-ui">
          {post.data.author && (
            <div class="flex items-center">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span>Por {post.data.author}</span>
            </div>
          )}
          
          {post.data.tags && post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {post.data.tags.map((tag: string) => (
                <span class="bg-primary-blue/10 text-primary-blue px-3 py-1 rounded-full text-sm font-medium">
                  {tag}
                </span>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
      <!-- Content area -->
      <div class="prose prose-lg prose-slate max-w-none p-8 md:p-12">
        <Content />
      </div>
      
      <!-- Share section -->
      <div class="border-t border-gray-100 p-8 md:p-12 bg-light-gray">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
          <div>
            <h3 class="text-lg font-heading font-medium text-dark-navy mb-2">
              ¿Te gustó este artículo?
            </h3>
            <p class="text-medium-gray font-body">
              Compártelo para que otros también puedan reflexionar sobre estos temas.
            </p>
          </div>
          
          <div class="flex gap-3">
            <button class="bg-primary-blue hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-ui font-medium transition-colors duration-300 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
              </svg>
              Twitter
            </button>
            
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-ui font-medium transition-colors duration-300 flex items-center">
              <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
              </svg>
              Facebook
            </button>
          </div>
        </div>
      </div>
    </div>
  </article>

  <!-- Related posts or navigation -->
  <section class="bg-light-gray py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h3 class="text-2xl font-heading font-medium text-dark-navy mb-8">
        Continúa explorando
      </h3>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a 
          href="/" 
          class="inline-flex items-center justify-center bg-white hover:bg-primary-blue hover:text-white text-primary-blue font-ui font-medium px-8 py-3 rounded-full border border-primary-blue transition-all duration-300 shadow-md hover:shadow-lg"
        >
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m7 7 5 5 5-5" />
          </svg>
          Ver todos los artículos
        </a>
        
        <a 
          href="/#posts" 
          class="inline-flex items-center justify-center bg-primary-blue hover:bg-blue-700 text-white font-ui font-medium px-8 py-3 rounded-full transition-all duration-300 shadow-md hover:shadow-lg"
        >
          Últimos posts
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Custom prose styles for better typography */
  .prose {
    font-family: var(--font-body);
  }
  
  .prose h1,
  .prose h2,
  .prose h3,
  .prose h4,
  .prose h5,
  .prose h6 {
    font-family: var(--font-heading);
    color: var(--dark-navy);
    font-weight: 500;
  }
  
  .prose p {
    color: var(--charcoal);
    line-height: 1.8;
    margin-bottom: 1.5em;
  }
  
  .prose blockquote {
    font-family: var(--font-heading);
    font-style: italic;
    border-left: 4px solid var(--primary-blue);
    background: var(--light-blue);
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 8px;
  }
  
  .prose code {
    background: var(--light-gray);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.9em;
  }
  
  .prose pre {
    background: var(--charcoal);
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
    overflow-x: auto;
  }
  
  .prose pre code {
    background: transparent;
    padding: 0;
    color: inherit;
  }
  
  .prose a {
    color: var(--primary-blue);
    text-decoration: underline;
    text-decoration-color: var(--light-blue);
    text-underline-offset: 4px;
    transition: all 0.3s ease;
  }
  
  .prose a:hover {
    color: var(--dark-navy);
    text-decoration-color: var(--primary-blue);
  }
</style>
